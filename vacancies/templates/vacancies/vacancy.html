{% extends 'base.html' %} {% load static %}
{% load article_tags %}

{% block title %} {{ vacancy.title }} - –ú–µ–¥–∏—Ü–∏–Ω—Å–∫–∏–π —Ü–µ–Ω—Ç—Ä –ü—Ä–æ–ó–¥–æ—Ä–æ–≤—å–µ {% endblock %}
{% block meta_title %} {{ vacancy.title }} - –ú–µ–¥–∏—Ü–∏–Ω—Å–∫–∏–π —Ü–µ–Ω—Ç—Ä –ü—Ä–æ–ó–¥–æ—Ä–æ–≤—å–µ {% endblock %}
{% block description %} –í –º–µ–¥. —Ü–µ–Ω—Ç—Ä–µ –ü—Ä–æ–ó–¥–æ—Ä–æ–≤—å–µ –≤–∞—Å –∂–¥—É—Ç –Ω–∞ –ø—Ä–∏–µ–º –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–µ –æ—Å—Ç–µ–æ–ø–∞—Ç—ã, –Ω–µ–≤—Ä–æ–ª–æ–≥–∏, —ç–Ω–¥–æ–∫—Ä–∏–Ω–æ–ª–æ–≥–∏
–∏ –ø—Å–∏—Ö–æ—Ç–µ—Ä–∞–ø–µ–≤—Ç—ã.üè• –ù–∞—à–∏ –∏–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä—ã –ø–æ –π–æ–≥–µ –∏ –ø–∏–ª–∞—Ç–µ—Å—É –ø—Ä–∏–≥–ª–∞—à–∞—é—Ç –∑–∞–ø–∏—Å–∞—Ç—å—Å—è –≤ –≥—Ä—É–ø–ø—ã –∏–ª–∏ –Ω–∞ –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–µ –∑–∞–Ω—è—Ç–∏—è.
–ü—Ä–æ–ó–¥–æ—Ä–æ–≤—å–µ - –∑–¥–æ—Ä–æ–≤—å–µ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è –∑–¥–µ—Å—å! {% endblock %}
{% block meta_description %} –í –º–µ–¥. —Ü–µ–Ω—Ç—Ä–µ –ü—Ä–æ–ó–¥–æ—Ä–æ–≤—å–µ –≤–∞—Å –∂–¥—É—Ç –Ω–∞ –ø—Ä–∏–µ–º –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–µ –æ—Å—Ç–µ–æ–ø–∞—Ç—ã, –Ω–µ–≤—Ä–æ–ª–æ–≥–∏,
—ç–Ω–¥–æ–∫—Ä–∏–Ω–æ–ª–æ–≥–∏ –∏ –ø—Å–∏—Ö–æ—Ç–µ—Ä–∞–ø–µ–≤—Ç—ã.üè• –ù–∞—à–∏ –∏–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä—ã –ø–æ –π–æ–≥–µ –∏ –ø–∏–ª–∞—Ç–µ—Å—É –ø—Ä–∏–≥–ª–∞—à–∞—é—Ç –∑–∞–ø–∏—Å–∞—Ç—å—Å—è –≤ –≥—Ä—É–ø–ø—ã –∏–ª–∏ –Ω–∞
–∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–µ –∑–∞–Ω—è—Ç–∏—è. –ü—Ä–æ–ó–¥–æ—Ä–æ–≤—å–µ - –∑–¥–æ—Ä–æ–≤—å–µ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è –∑–¥–µ—Å—å! {% endblock %}

{% block script %}
<script type=module crossorigin src="{% static 'js/header.js' %}"></script>
<script type=module crossorigin src="{% static 'js/booking.js' %}"></script>
<script type=module crossorigin src="{% static 'js/ask-form.js' %}"></script>
<script type=module crossorigin src="{% static 'js/footer.js' %}"></script>
<script src="{% static 'js/vendor/Imask.min.js' %}" defer></script>
{% endblock %} {% block content %}
<div class=blog-list-page>
    <div id=header></div>
    <div class="section section--inpage">
        <div class="container blog-list">
            <h1 class="blog-list__header blog-list__header-vacancy">–í–∞–∫–∞–Ω—Å–∏—è "{{ vacancy.title }}"</h1>
            <div class=content>
                <div class=content__main>
                    <div class=content__intro>
                        {{ vacancy.preamble|markdown }}
                    </div>
                    <div class=content__description>
                        {{ vacancy.duties|markdown }}
                    </div>
                    <div class=content__description>
                        {{ vacancy.requirements|markdown }}
                    </div>
                    <div class=content__description>
                        {{ vacancy.conditions|markdown }}
                    </div>
                </div>
                <div class=directions>
                        <form id="vacancyReplyForm" class=form method=post>
                            {% csrf_token %}
                            <div class="form__title form__title-vacancy">–û—Ç–∫–ª–∏–∫–Ω—É—Ç—å—Å—è –Ω–∞ –≤–∞–∫–∞–Ω—Å–∏—é</div>
                            <div class=form__field>
                                {{ form.last_name }}
                                <label for="{{ form.last_name.id_for_label }}" class=form__label>{{ form.last_name.label }}</label>
                            </div>
                            <div class=form__field>
                                {{ form.first_name }}
                                <label for="{{ form.first_name.id_for_label }}" class=form__label>{{ form.first_name.label }}</label>
                            </div>
                            <div class=form__field>
                                {{ form.phone }}
                                <label for="{{ form.phone.id_for_label }}" class=form__label>{{ form.phone.label }}</label>
                            </div>
                            <div class=form__field>
                                <label class="input-file">
                                    {{ form.resume }}
                                     <span class="input-file-btn">–ü—Ä–∏–∫—Ä–µ–ø–∏—Ç—å —Ä–µ–∑—é–º–µ</span>           
                                    <span class="input-file-text">–ú–∞–∫—Å–∏–º—É–º 5–ú–±</span>
                              </label>
                            </div>
                            <button type=submit class="form__button button-osta">
                                –û—Ç–∫–ª–∏–∫–Ω—É—Ç—å—Å—è
                            </button>
                        </form>
                </div>
            </div>
        </div>
    </div>
    <div id=doctors></div>
    <div id=booking></div>
    <div id=ask-form></div>
    <div id=footer></div>
</div>

<script
  src="https://code.jquery.com/jquery-3.6.3.js"
  integrity="sha256-nQLuAZGRRcILA+6dMBOvcRh5Pe310sBpanc6+QBmyVM="
  crossorigin="anonymous">
</script>
<script src="{% static 'js/vendor/Imask.min.js' %}" defer></script>
<script>
// –ü–æ–ª–µ –¥–ª—è —Ä–µ–∑—é–º–µ
const form = document.querySelector("#vacancyReplyForm");
const fileInput = document.querySelector('.input-file input[type=file]');
const fileText = document.querySelector('.input-file .input-file-text');

// –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –≤—ã–±–æ—Ä–∞ —Ñ–∞–π–ª–∞
fileInput.addEventListener('change', function(event) {
    let file = event.target.files[0];
    if (file) {
        fileText.textContent = file.name;
    } else {
        fileText.textContent = "–ú–∞–∫—Å–∏–º—É–º 5–ú–±"; 
    }
});

document.addEventListener("DOMContentLoaded", function() {
// –ú–∞—Å–∫–∞ –¥–ª—è —Ç–µ–ª–µ—Ñ–æ–Ω–∞
    var phoneInput = document.querySelector("#id_phone"),
    phoneMask = IMask(phoneInput, {
        mask: "+{7} (000) 000 00 00"
    });

    function validatePhoneNumber() {
    let t = phoneInput.value.replace(/\D/g, "");
    return t.length < 11 ? (phoneInput.setCustomValidity("–ù–µ–æ–±—Ö–æ–¥–∏–º–æ –º–∏–Ω–∏–º—É–º 11 —Ü–∏—Ñ—Ä"), !1) : (phoneInput.setCustomValidity(""), !0)
    }
    phoneInput.addEventListener("input", function() {
    validatePhoneNumber()
    });
    const toastHtml = `
    <div class="toast-container position-fixed bottom-0 end-0 p-3">
    <div id="toastRequestSent" class="toast" role="alert" aria-live="assertive" aria-atomic="true">
    <div class="toast-header">
        <img src="${window.origin}/static/images/favicon-16x16.png" class="rounded me-2" alt="–ò–∫–æ–Ω–∫–∞">
        <strong class="me-auto">–§–æ—Ä–º–∞ –±—ã–ª–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞!</strong>
        <small>—Ç–æ–ª—å–∫–æ —á—Ç–æ</small>
        <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
    </div>
    <div class="toast-body">
        –°–ø–∞—Å–∏–±–æ –∑–∞ –æ—Ç–∫–ª–∏–∫ –Ω–∞ –≤–∞–∫–∞–Ω—Å–∏—é.
    </div>
    </div>
    </div>
    `;

    function showToast() {
    document.body.insertAdjacentHTML("beforeend", toastHtml);
    let t = document.getElementById("toastRequestSent"),
        a = bootstrap.Toast.getOrCreateInstance(t);
    a.show(), t.addEventListener("hidden.bs.toast", () => {
        t.remove()
    })
    }

    const form = document.querySelector("#vacancyReplyForm");
    form.addEventListener("submit", async function(t) {
        t.preventDefault();
        
        let a = new FormData(form);

        if (fileInput.files.length > 0) {
            a.append("resume", fileInput.files[0]);
        } 

        console.log(a)

        e = document.querySelector('input[name="csrfmiddlewaretoken"]').value;
        form.reset(), showToast();
        fileText.textContent = "–ú–∞–∫—Å–∏–º—É–º 5–ú–±";
        try {
            let n = await fetch(`/vacancies/api/save_reply/`, {
                method: "POST",
                body: a,
                headers: {
                    "X-CSRFToken": e
                }
            });
            console.log(n.json())
        } catch (o) {
            console.error("–û—à–∏–±–∫–∞ –∑–∞–ø—Ä–æ—Å–∞:", o)
        }
    });
})
</script>
{% endblock %}